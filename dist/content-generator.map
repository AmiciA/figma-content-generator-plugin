{"version":3,"sources":["utilities.js","api.js","content-generator.js","index.js"],"names":["getRandom","arr","n","result","Array","len","length","taken","RangeError","x","Math","floor","random","toast","message","App","_store","dispatch","type","payload","getMenFaces","loadXHR","getWomenFaces","getPersons","count","getPersonsMale","getPersonsFemale","url","Promise","resolve","reject","xhr","XMLHttpRequest","open","responseType","onerror","onload","status","response","statusText","send","err","ContentGenerator","getRandomMenFaces","state","menFaces","then","getRandomWomenFaces","womenFaces","fillMenFaces","selectedNodes","Object","keys","_state","mirror","sceneGraphSelection","faces","addFillToSelectedLayer","fillWomenFaces","fills","map","node","index","sendMessage","nodeIds","currentFill","selectionProperties","fillPaints","cappedIndex","newFill","updateSelectionProperties","name","id","contentGeneratorPlugin","options","itemLabel","triggerFunction","bind","menuItems","title","trigger","item","window","figmaPlugin","createPluginsMenuItem","createContextMenuItem","Selection","ObjectsPanel","contentGenerator"],"mappings":"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","file":"content-generator.map","sourceRoot":"../src","sourcesContent":["export const getRandom = (arr, n) => {\n  var result = new Array(n),\n      len = arr.length,\n      taken = new Array(len);\n  if (n > len)\n      throw new RangeError(\"getRandom: more elements taken than available\");\n  while (n--) {\n      var x = Math.floor(Math.random() * len);\n      result[n] = arr[x in taken ? taken[x] : x];\n      taken[x] = --len in taken ? taken[len] : len;\n  }\n  return result;\n}\n\nexport const toast = (message) => {\n  App._store.dispatch({\n    type: \"VISUAL_BELL_ENQUEUE\",\n    payload: {\n        message: message || \"\"\n      }\n  });\n}","export const getMenFaces = () => {\n    return loadXHR(\"https://cdes.github.io/cdes/figma-content-generator-plugin/dist/men-faces.json\");\n}\n\nexport const getWomenFaces = () => {\n    return loadXHR(\"https://cdes.github.io/cdes/figma-content-generator-plugin/dist/women-faces.json\");\n}\n\nexport const getPersons = (count) => {\n    return loadXHR(`https://randomuser.me/api/?results=${count}`);\n}\n\nexport const getPersonsMale = (count) => {\n    return loadXHR(`https://randomuser.me/api/?results=${count}&?gender=male`);\n}\n\nexport const getPersonsFemale = (count) => {\n    return loadXHR(`https://randomuser.me/api/?results=${count}&?gender=female`);\n}\n\nfunction loadXHR(url) {\n    return new Promise(function(resolve, reject) {\n        try {\n            var xhr = new XMLHttpRequest();\n            xhr.open(\"GET\", url);\n            xhr.responseType = \"json\";\n            xhr.onerror = function() {reject(\"Network error.\")};\n            xhr.onload = function() {\n                if (xhr.status === 200) {resolve(xhr.response)}\n                else {reject(\"Loading error:\" + xhr.statusText)}\n            };\n            xhr.send();\n        }\n        catch(err) {reject(err.message)}\n    });\n}\n","import { getRandom, toast } from \"./utilities\";\nimport { getMenFaces, getWomenFaces, getPersons, getPersonsMale, getPersonsFemale } from \"./api\";\n\nclass ContentGenerator {\n  constructor() {\n    this.name = 'Content Generator';\n    this.id = 'contentGenerator',\n    this.state = {\n      menFaces: [],\n      womenFaces: [],\n    }\n  }\n  \n  getRandomMenFaces = (count) => {\n    return new Promise((resolve, reject) => {\n      if(this.state.menFaces.length === 0) {\n        getMenFaces().then((menFaces) => {\n          this.state.menFaces = menFaces;\n          resolve(getRandom(menFaces, count));\n        });\n      }\n      else {\n        resolve(getRandom(this.state.menFaces, count % 99));\n      }\n    });\n  }\n\n  getRandomWomenFaces = (count) => {\n    return new Promise((resolve, reject) => {\n      if(this.state.womenFaces.length === 0) {\n        getWomenFaces().then((womenFaces) => {\n          this.state.womenFaces = womenFaces;\n          resolve(getRandom(womenFaces, count));\n        });\n      }\n      else {\n        resolve(getRandom(this.state.womenFaces, count % 99));\n      }\n    });\n  }\n  \n  fillMenFaces = () => {\n    const selectedNodes = Object.keys(App._state.mirror.sceneGraphSelection);\n    \n    if (selectedNodes.length === 0) {\n      toast('You must select at least one layer.');\n      return;\n    }\n    \n    this.getRandomMenFaces(selectedNodes.length).then(faces => {\n      this.addFillToSelectedLayer(selectedNodes, faces);\n    });\n  }\n\n  fillWomenFaces = () => {\n    const selectedNodes = Object.keys(App._state.mirror.sceneGraphSelection);\n    \n    if (selectedNodes.length === 0) {\n      toast('You must select at least one layer.');\n      return;\n    }\n    \n    this.getRandomWomenFaces(selectedNodes.length).then(faces => {\n      this.addFillToSelectedLayer(selectedNodes, faces);\n    });\n  }\n  \n  addFillToSelectedLayer = (selectedNodes, fills) => {\n    selectedNodes.map((node, index) => {\n      App.sendMessage('clearSelection');\n      App.sendMessage('addToSelection', { nodeIds: [node] });\n\n      const currentFill = App._state.mirror.selectionProperties.fillPaints;\n      const cappedIndex = index % (fills.length);\n      const newFill = fills[cappedIndex];\n\n      App.updateSelectionProperties({\n        fillPaints: [...currentFill, newFill]\n      })\n      App.sendMessage('clearSelection');\n    })\n  }\n}\n\nconst contentGeneratorPlugin = new ContentGenerator();\n\nconst options = [\n  \"Fill Faces\",\n  () => {},\n  null,\n  [\n    {\n      itemLabel: \"Men\",\n      triggerFunction: contentGeneratorPlugin.fillMenFaces.bind(contentGeneratorPlugin),\n    },\n    {\n      itemLabel: \"Women\",\n      triggerFunction: contentGeneratorPlugin.fillWomenFaces.bind(contentGeneratorPlugin),\n    },\n  ],\n];\n\nconst menuItems = [\n  {\n    title: \"Generate: Men Faces\",\n    trigger: contentGeneratorPlugin.fillMenFaces.bind(contentGeneratorPlugin),\n  },\n  {\n    title: \"Generate: Women Faces\",\n    trigger: contentGeneratorPlugin.fillWomenFaces.bind(contentGeneratorPlugin),\n  },\n];\n\nmenuItems.map(item => {\n  window.figmaPlugin.createPluginsMenuItem(item.title, item.trigger);\n  window.figmaPlugin.createContextMenuItem.Selection(item.title, item.trigger);\n  window.figmaPlugin.createContextMenuItem.ObjectsPanel(item.title, item.trigger);\n});","import contentGenerator from './content-generator';\n\nexport default contentGenerator;"]}